<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Network | Basic usage</title>
	<link rel="stylesheet" type="text/css" href="css/themes/default/easyui.css">
	<link rel="stylesheet" type="text/css" href="css/themes/icon.css">
	<link rel="stylesheet" type="text/css" href="css/demo.css">
	<link rel="stylesheet" type="text/css" href="css/vis.css">
	<link rel="stylesheet" type="text/css" href="css/multiselect.css" media="screen"  >
	
	<style type="text/css">
		#mynetwork {
	      width: 100%;
	      height: 500px;
	      border: 1px solid lightgray;
	    }
	</style>
	
	<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
	<script type="text/javascript" src="js/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="js/keycharm.js"></script>
	<script type="text/javascript" src="js/vis.js"></script>
	<script type="text/javascript" src="js/jquery.multi-select.js"></script>
	<script type="text/javascript">
	
	$('#my-select').multiSelect()
	
	var matrix = null ;
	var nodeIds = null;
	var container = null ;
	var data = null ;
	var nodes = null;
	var edges = null;
	var network = null;

	 function introspectDatatypes(){
		destroy() ;
		initNetwork() ;
		var url = $("#url_text").textbox('getValue');
		 $.ajax({ 
				contentType: "application/json",
	            type: "POST",
	            dataType: "json",
	            data: "{\"url\":\""+encodeURI(url)+"\"}" ,
	            url: "/dagger/api/service/datatypes/scan/",
	            success: function(response){        
	            	var jsonRsp = jQuery.parseJSON(JSON.stringify(response));
	            	var jsonArray = jsonRsp.DataTypes ;
	            	//init matrix to track edges 
	            	for(var i=0; i<jsonArray.length; i++){  
            			matrix[i] = new Array(); 
	            		for(var j=0; j<jsonArray.length; j++){   
	            			matrix[i][j] = 0 ;
	            		}
            		}
	            	
	            	//generate nodes & edges
	            	jQuery.each(jsonArray, function( i, item ) {
            		    setTimeout(function(){
            		    	addNode(i, item.DataType, item.count, item.Possibility) ;
    	            		if(i>0){
    	            			while(i==(from=getRandomArbitrary(0,nodeIds.length))) ;
    		            		addEdge(from,i) ;
    	            		}
            		    	var percent = Math.round(i/(jsonArray.length-1) * 100) ;
   	            		 	$('#progressbar').progressbar('setValue', percent);
            		    },i*100);
            		});
	            	
	            },
		         error: function (msg, url, line) {
		             alert('msg = ' + msg.toString() + ', url = ' + url + ', line = ' + line);
		         }
	        }); 
		
	}
	 
	function destroy() {
	     if (network !== null) {
	       network.destroy();
	       network = null;
	     }
	}
	
	function initNetwork() {
		matrix = new Array() ;
		// store existing node Ids
		nodeIds = [];
		// create an array with nodes
		nodes = new vis.DataSet([]);
		// create an array with edges
		edges = new vis.DataSet([]);
		// create a network
		container = document.getElementById('mynetwork');
		data = {
		  nodes: nodes,
		  edges: edges
		};
		
		network = new vis.Network(container, data, options);
		network.on("click", function (params) {
		    params.event = "[original event]";
		    document.getElementById('eventSpan').innerHTML = '<h2>Click event:</h2>' + JSON.stringify(params, null, 4);
		});
	  
		//https://github.com/AlexDM0/keycharm
		var keys = vis.keycharm();
		keys.bind("delete", function(event) {
			var selection = network.getSelection();
			var nodes = selection.nodes ;
			jQuery.each(nodes, function(i, nodeId) {
				/** remove action **/
				removeNode(nodeId) ;
			});
		});
	}
	 
	function getRandomArbitrary(min, max) {
	    return Math.floor(Math.random() * (max - min) + min);
	}
	
	function addNode(index, name, val, poss) {
		//var div = document.getElementById('mynetwork');
	    //var clientWidth = div.clientWidth;
		//var clientHeight = div.clientHeight;
		
        //nodes.add({id:index, value:val, label:name, x: getRandomArbitrary(0,300), y: getRandomArbitrary(0,200)});
        nodes.add({id:index, value:val, label:name});
        nodeIds.push(index);
    }
	
	function removeNode(nodeId) {
        nodes.remove({id:nodeId});
        var connCount = 0 ;
        var relocPos = -1 ;
        
        for(var i=0; i<matrix.length; i++){
        	if(matrix[nodeId][i]==1){
        		if(connCount==0){
        			connCount++ ;
            		relocPos = i ;
            		continue ;
        		}
        		if(connCount==1){
        			addEdge(i,relocPos) ;
        		}
        	}
        }
        
        for(var i=0; i<matrix.length; i++){
        	if(i==nodeId){
        		continue ;
        	}
        	matrix[i][nodeId] = -1 ;
        	matrix[nodeId][i] = -1 ;
        }
        
    }
	
	function addEdge(start, end) {
		edges.add({from: start, to: end});
		matrix[start][end] = 1 ;
		matrix[end][start] = 1 ;
    }

  
  
  var options = {
		  interaction:{
			  	multiselect: true,
			  	navigationButtons: true,
			  	keyboard: true,
			    hover: true
			  },
			  
		  nodes: {
			  color: {
			      border: '#FFA500',
			      background: '#FFA500',
			      highlight: {
			        border: '#FFA500',
			        background: '#FF7900'
			      },
			      hover: {
			        border: '#FF7900',
			        background: '#FF7900'
			      }
			    },
	          shape: 'circle',
	          shdow: true ,
	          scaling:{
	            label: {
	              min:8,
	              max:20
	            }
	          }
	        }
	};
 	
	
</script>

</head>
<body>

<p>
  Create a simple network with some nodes and edges.
</p>

<table style="width:100%; height:800px">
	<tr style="height:30px">
		<td>
			<div >
			    <input class="easyui-textbox" id="url_text" data-options="buttonText:'Introspect',prompt:'URL:(http(s)://)',onClickButton:function(){introspectDatatypes();}"  style="border-color:#FFA500;width:100%;height:32px;">
			</div>
		</td>
	</tr>
	
	<tr style="height:500px">
		<td>
			<div id="mynetwork">
				<div class="vis-network" style="position: relative; overflow: hidden; touch-action: pan-y; -moz-user-select: none; width: 100%; height: 100%;" tabindex="900">
					<canvas style="position: relative; touch-action: none; -moz-user-select: none; width: 100%; height: 100%;" width="1200" height="1200"></canvas>
					<div class="vis-navigation">
						<div class="vis-button vis-up" style="touch-action: pan-y; -moz-user-select: none;"></div>
						<div class="vis-button vis-down" style="touch-action: pan-y; -moz-user-select: none;"></div>
						<div class="vis-button vis-left" style="touch-action: pan-y; -moz-user-select: none;"></div>
						<div class="vis-button vis-right" style="touch-action: pan-y; -moz-user-select: none;"></div>
						<div class="vis-button vis-zoomIn" style="touch-action: pan-y; -moz-user-select: none;"></div>
						<div class="vis-button vis-zoomOut" style="touch-action: pan-y; -moz-user-select: none;"></div>
						<div class="vis-button vis-zoomExtends" style="touch-action: pan-y; -moz-user-select: none;"></div>
					</div>
				</div>
			</div>
		</td>
	</tr>
	
	<tr style="height:30px">
		<td>
			<div id="progressbar" class="easyui-progressbar" style="width:100%;"></div>
		</td>
	</tr>
	
	<tr style="width:100%; height:300px">
		<td>
			<table>
	  			<tr>
		  		<td>
		  			
				     <ul id="left" class="easyui-datalist" title="Candidates" lines="false" style="width:400px;height:250px">
				        <li value="AL">Alabama</li>
				        <li value="AK">Alaska</li>
				        <li value="AZ">Arizona</li>
				        <li value="AR">Arkansas</li>
				        <li value="CA">California</li>
				        <li value="CO">Colorado</li>
				        <li value="CT">Connecticut</li>
				        <li value="DE">Delaware</li>
				        <li value="FL">Florida</li>
				        <li value="WV">West Virginia</li>
				        <li value="WI">Wisconsin</li>
				        <li value="WY">Wyoming</li>
				    </ul>
		  		</td>
		  		<td>
		  			<img alt="" src="img/switch.png">
		  		</td>
		  		<td>
		  			  <ul id="right" class="easyui-datalist" title="Selection" lines="false" style="width:400px;height:250px">
				        <li value="AL">Alabama</li>
				        <li value="AK">Alaska</li>
				        <li value="AZ">Arizona</li>
				        <li value="AR">Arkansas</li>
				        <li value="CA">California</li>
				        <li value="CO">Colorado</li>
				        <li value="CT">Connecticut</li>
				        <li value="DE">Delaware</li>
				        <li value="FL">Florida</li>
				        <li value="WV">West Virginia</li>
				        <li value="WI">Wisconsin</li>
				        <li value="WY">Wyoming</li>
				    </ul>
		  		</td>
		  		</tr>
		  </table>
		</td>
	</tr>

</table>

<pre id="eventSpan"></pre>


</body>
</html>
